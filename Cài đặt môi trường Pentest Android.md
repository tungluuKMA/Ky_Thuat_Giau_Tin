# CÃ i Ä‘áº·t mÃ´i trÆ°á»ng Pentest Android

# Windows Subsystem for Android

Windows Subsystem for Android (WSA) lÃ  má»™t ná»n táº£ng cÃ´ng nghá»‡ má»›i trÃªn Windows 11, nÃ³ há»— trá»£ cháº¡y trá»±c tiáº¿p cÃ¡c á»©ng dá»¥ng Android thÃ´ng qua Amazon Appstore trÃªn Windows 11 mÃ  khÃ´ng cáº§n pháº£i cÃ i thÃªm pháº§n má»m giáº£ láº­p Android.

## **+ BÆ°á»›c 1:**Â CÃ i Ä‘áº·t WSA

Truy cáº­p github ([https://github.com/creative-builds/WSA-Magisk/releases](https://github.com/creative-builds/WSA-Magisk/releases)) vÃ  chá»n cÃ i Ä‘áº·t phiÃªn báº£n x64 Release-Night-with-masigk-â€¦-stable-MindTheGapps dÃ nh cho Windows.

[https://github.com/creative-builds/WSA-Magisk/releases/download/v2023-08-01/WSA_2305.40000.6.0_x64_Release-Nightly-with-magisk-26.1.26100.-stable-MindTheGapps-13.0-RemovedAmazon.7z](https://github.com/creative-builds/WSA-Magisk/releases/download/v2023-08-01/WSA_2305.40000.6.0_x64_Release-Nightly-with-magisk-26.1.26100.-stable-MindTheGapps-13.0-RemovedAmazon.7z)

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled.png?raw=true)

Sau khi táº£i vá» xong, má»Ÿ thÆ° má»¥c vá»«a táº£i vÃ  cháº¡y file run.bat. File nÃ y sáº½ cháº¡y file Install.ps1 Ä‘á»ƒ cÃ i Ä‘áº·t cÃ¡c cáº¥u hÃ¬nh cáº§n thiáº¿t, hoáº·c chÃºng ta cÃ³ thá»ƒ cháº¡y trá»±c tiáº¿p file Install.ps1 báº±ng powershell.

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%201.png?raw=true)

Sau khi quÃ¡ trÃ¬nh cÃ i Ä‘áº·t hoÃ n táº¥t, chÃºng ta Ä‘Ã£ cÃ i thÃ nh cÃ´ng WSA cÃ¹ng vá»›i Magisk, Ä‘i kÃ¨m vá»›i Ä‘Ã³ lÃ  Play Store Ä‘á»ƒ cÃ i Ä‘áº·t cÃ¡c á»©ng dá»¥ng cáº§n thiáº¿t. BÃ¢y giá» chÃºng ta chá»‰ cáº§n vÃ o Play Store vÃ  cÃ i cÃ¡c á»©ng dá»¥ng mong muá»‘n vÃ  sá»­ dá»¥ng.

Tuy nhiÃªn sáº½ khÃ³ quáº£n lÃ½ cÃ¡c á»©ng dá»¥ng cÅ©ng nhÆ° cáº¥u hÃ¬nh mÃ¡y áº£o khi khÃ´ng cÃ³ má»™t giao diá»‡n android cá»¥ thá»ƒ. VÃ¬ váº­y tiáº¿p theo sáº½ cÃ i Ä‘áº·t Windows Launcher

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%202.png?raw=true)

Sau khi cÃ i Ä‘áº·t thÃ nh cÃ´ng, má»Ÿ pháº§n má»m Windows Subsystem for Android vÃ  báº­t cháº¿ Ä‘á»™ Developer Mode. LÆ°u Ã½ Ä‘á»‹a chá»‰ ip nÃ y sáº½ dÃ¹ng Ä‘á»ƒ connect adb

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%203.png?raw=true)

## **+ BÆ°á»›c 2:**Â CÃ i Ä‘áº·t Certificate

VÃ¬ Ä‘Ã£ cÃ³ sáºµn cÃ´ng cá»¥ Magisk, nÃªn viá»‡c cÃ i Ä‘áº·t chá»©ng chá»‰ sáº½ dá»… dÃ ng hÆ¡n ráº¥t nhiá»u nhá» vÃ o ***Magisk Trust User Certs.*** Module nÃ y sáº½ Ä‘Æ°a táº¥t cáº£ user certificateÂ Ä‘Ã£ cÃ i Ä‘áº·t thÃ nh vÃ  trong system certificate. 

Táº£i AlwayTrustUserCerts.zip táº¡i github sau: [https://github.com/NVISOsecurity/MagiskTrustUserCerts/releases/tag/v0.4.1](https://github.com/NVISOsecurity/MagiskTrustUserCerts/releases/tag/v0.4.1)

Sá»­ dá»¥ng BurpSuite Ä‘á»ƒ export ra Certificate ( CÃ³ thá»ƒ dÃ¹ng Ä‘á»‹nh dáº¡ng DER hay PEM Ä‘á»u Ä‘Æ°á»£c)

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%204.png?raw=true)

Sau Ä‘Ã³ sá»­ dá»¥ng adb Ä‘á»ƒ káº¿t ná»‘i tá»›i devices thÃ´ng qua cÃ¢u lá»‡nh:

```powershell
adb connect 127.0.0.1:58526
```

Tiáº¿p Ä‘áº¿n chÃºng ta sáº½ Ä‘Æ°a tá»‡p zip trÃªn cÃ¹ng vá»›i certificate Ä‘Æ°á»£c export tá»« BurpSuite vÃ o trong kho lÆ°u trá»¯ cá»§a thiáº¿t bá»‹ Android.

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%205.png?raw=true)

Sau Ä‘Ã³ má»Ÿ Magisk, chá»n modules vÃ  chá»n ***Install from storage***Â vÃ  lá»±a chá»n tá»‡p *AlwayTrustUserCert.zip*Â vá»«a Ä‘Æ°á»£c Ä‘Æ°a vÃ o.

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%206.png?raw=true)

<aside>
ğŸ’¡ Fix lá»—i Cert Alwaytrustuser bá»‹ máº¥t khi reboot WSA
+ B1: Sá»­ dá»¥ng Magisk Install cert
+ B2: Káº¿t ná»‘i adb shell
+ B3: Copy all files and overwrite from /data/adb/modules_update/(your installed module) to /data/adb/modules/(your installed module)
+ B4: DELETE the file called "update" from /data/adb/modules/(your installed module)
+ B5:  Repeat the same steps on other modules. When you are done, DELETE the modules_update folder
+ B6: Reboot WSA via Magisk app

</aside>

NhÆ° váº­y lÃ  ta Ä‘Ã£ cÃ i thÃ nh cÃ´ng. Tiáº¿p Ä‘áº¿n lÃ  cÃ i Ä‘áº·t BurpSuite certificate

Má»Ÿ á»©ng dá»¥ng Microsoft Launcher, chá»n ***Setting > Security > More Security Setting > Encryption & credential > Install a Certificate.*** Lá»±a chá»n ***CA certificate***Â vÃ  chá»n Install anyway. Chá»n Install BurpSuite certificate Ä‘Ã£ Ä‘Æ°á»£c Ä‘Æ°a vÃ o á»Ÿ bÆ°á»›c trÃªn

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%207.png?raw=true)

ThÃ´ng bÃ¡o cÃ i Ä‘áº·t thÃ nh cÃ´ng. Truy cáº­p ***Trusted Credentials***Â vÃ  chá»n tab User Ä‘á»ƒ kiá»ƒm tra

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%208.png?raw=true)

Äá»“ng thá»i bÃªn tab system, certificate Ä‘Ã£ Ä‘Æ°á»£c tá»± Ä‘á»™ng thÃªm vÃ o ( Restart láº¡i WSA náº¿u chÆ°a cÃ³)

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%209.png?raw=true)

## **+ BÆ°á»›c 3:**Â Cáº¥u hÃ¬nh Proxy

Má»Ÿ Microsoft Launcher. Chá»n ***Setting > Internet.*** Báº¥m biá»ƒu tÆ°á»£ng cÃ i Ä‘áº·t cá»§a máº¡ng wifi Ä‘ang sá»­ dá»¥ng

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2010.png?raw=true)

Kiá»ƒm tra cÃ¡c interface tá»“n táº¡i trÃªn mÃ¡y mÃ  BurpSuite cÃ³ thá»ƒ láº¯ng nghe, ta cÃ³ thá»ƒ sá»­ dá»¥ng báº¥t kÃ¬ interface nÃ o náº¿u muá»‘n.

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2011.png?raw=true)

Cáº¥u hÃ¬nh Ä‘á»‹a chá»‰ Proxy cá»§a mÃ¡y áº£o cho Ä‘i qua Ä‘á»‹a chá»‰ 192.168.100.1, port 8080

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2012.png?raw=true)

Cáº¥u hÃ¬nh BurpSuite láº¯ng nghe á»Ÿ má»i interfaces

Sá»­ dá»¥ng á»©ng dá»¥ng báº¥t ká»³, cÃ³ thá»ƒ tháº¥y cÃ¡c request cá»§a á»©ng dá»¥ng Ä‘Ã£ Ä‘i qua BurpSuite. NhÆ° váº­y chÃºng ta Ä‘Ã£ xÃ¢y dá»±ng thÃ nh cÃ´ng mÃ´i trÆ°á»ng kiá»ƒm thá»­ cho á»©ng dá»¥ng trÃªn thiáº¿t bá»‹ Android báº±ng cÃ´ng cá»¥ Windows Subsystem for Android

# Android Virtual Devices ( Android Studio)

## + BÆ°á»›c 1: CÃ i Ä‘áº·t Android Studio.

Truy cáº­p trang chá»§ cá»§a android studio vÃ  chá»n má»¥c Download. Sau Ä‘Ã³ táº£i file vÃ  cÃ i Ä‘áº·t

Chá»n má»¥c Android Virtual Device Ä‘á»ƒ cÃ i Ä‘áº·t ADV cÃ¹ng vá»›i Android Studio

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2013.png?raw=true)

## + BÆ°á»›c 2: CÃ i Ä‘áº·t ADV

Sau khi quÃ¡ trÃ¬nh cÃ i Ä‘áº·t á»©ng dá»¥ng hoÃ n táº¥t. Chá»n *More Action*Â vÃ  chá»n *Virtual Device Manager*Â 

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2014.png?raw=true)

Thiáº¿t láº­p cÃ¡c cáº¥u hÃ¬nh cho mÃ¡y áº£o android. ( Recommend: Pixel 5, API 31)

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2015.png?raw=true)

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2016.png?raw=true)

CÃ i Ä‘áº·t thÃ nh cÃ´ng

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2017.png?raw=true)

## **+ BÆ°á»›c 4:** CÃ i Ä‘áº·t Certificate

[https://www.notion.so/bcpentest/C-i-cacert-Android-557675942dd545e097af965838d648c7](CÃ i%20cacert%20Android.md)

## + BÆ°á»›c 5: CÃ i Ä‘áº·t proxy

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2018.png?raw=true)

Chá»n tab ***Setting > Proxy***

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2019.png?raw=true)

Máº·c Ä‘á»‹nh táº¡i BurpSuite sáº½ láº¯ng nghe qua localhost port 8080, cáº¥u hÃ¬nh Proxy cá»§a mÃ¡y android cho Ä‘i qua locahost.
Khá»Ÿi cháº¡y má»™t á»©ng dá»¥ng báº¥t ká»³, cÃ³ thá»ƒ tháº¥y cÃ¡c request Ä‘i qua máº¡ng Ä‘Ã£ Ä‘Æ°á»£c báº¯t láº¡i thÃ nh cÃ´ng á»Ÿ BurpSuite, nhÆ° váº­y chÃºng ta Ä‘Ã£ cÃ i Ä‘áº·t thÃ nh cÃ´ng mÃ´i trÆ°á»ng Ä‘á»ƒ kiá»ƒm thá»­ á»©ng dá»¥ng trÃªn thiáº¿t bá»‹ Android báº±ng cÃ´ng cá»¥ Android Studio

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2020.png?raw=true)

# Android Virtual Devices with PlayStore ( Android Studio)

### Táº£i vÃ  cÃ i Android Studio báº£n má»›i nháº¥t

Truy cáº­p [https://developer.android.com/studio](https://developer.android.com/studio), táº£i vá» báº£n má»›i nháº¥t vÃ  cÃ i Ä‘áº·t

### Táº¡o thiáº¿t bá»‹ má»›i cÃ³ há»— trá»£ PlayStore

![Untitled](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/Untitled%2021.png?raw=true)

### Root thiáº¿t bá»‹

[https://gitlab.com/newbit/rootAVD](https://gitlab.com/newbit/rootAVD)

### CÃ i Cert BurpSuite

Xuáº¥t file Cert BurpSuite, sau Ä‘Ã³ sá»­ dá»¥ng lá»‡nh dÆ°á»›i Ä‘á»ƒ xuáº¥t file `9a5ba575.0`

```jsx
openssl x509 -inform der -in cacert.der -out 9a5ba575.0
```

Ghi Ä‘Ã¨ file 9a5ba575.0 láº¥y Ä‘Æ°á»£c vÃ o file zip dÆ°á»›i Ä‘Ã¢y, sau Ä‘Ã³ cÃ i zip vá»›i Magisk bÃªn trong mÃ¡y áº£o.

[BurpCertInstaller.zip](CÃ i%20Ä‘áº·t%20mÃ´i%20trÆ°á»ng%20Pentest%20Android/BurpCertInstaller.zip?raw=true)